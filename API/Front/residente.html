<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Gestión de Residentes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
  <!-- Dentro del body -->
<div id="menu-container"></div>

<script>
  fetch('menu.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('menu-container').innerHTML = html;
    });
</script>

  <div class="container my-5">
    <h1 class="mb-4">Gestión de Residentes</h1>
    <form id="formResidente">
      <div class="row g-3">
        <div class="col-md-3"><label>ID</label><input type="number" id="id" class="form-control" /></div>
        <div class="col-md-4"><label>Nombre</label><input type="text" id="nombre" class="form-control" /></div>
        <div class="col-md-4"><label>Apellido</label><input type="text" id="apellido" class="form-control" /></div>
        <div class="col-md-3"><label>Género</label><select id="genero" class="form-select"><option value="">Seleccione</option><option>Femenino</option><option>Masculino</option><option>Otro</option></select></div>
        <div class="col-md-3"><label>Contacto</label><input type="number" id="contacto" class="form-control" /></div>
        <div class="col-md-5"><label>Dirección</label><input type="text" id="direccion" class="form-control" /></div>
        <div class="col-md-3"><label>Estado</label><select id="estado" class="form-select"><option value="">Seleccione</option><option>Activo</option><option>Inactivo</option></select></div>
      </div>
      <div class="mt-4 text-center">
        <button type="button" id="guardar" class="btn btn-primary">Guardar</button>
        <button type="button" id="actualizar" class="btn btn-primary" style="display:none;">Actualizar</button>
        <button type="button" onclick="limpiar()" class="btn btn-danger">Limpiar</button>
      </div>
    </form>

    <div class="table-responsive mt-5">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
  <tr>
    <th>ID</th>
    <th>Nombre</th>
    <th>Apellido</th>
    <th>Género</th>
    <th>Contacto</th>
    <th>Dirección</th>
    <th>Estado</th>
    <th>Acciones</th>
  </tr>
</thead>

        <tbody id="tbodyResidente"></tbody>
      </table>
    </div>
  </div>

  <script>
    const URL = 'http://localhost:3000/api/residentes/';
    function limpiar(){
      $('#formResidente')[0].reset();
      $('#guardar').show(); $('#actualizar').hide();
    }
    function cargar(){
      $.get(URL, data => {
        $('#tbodyResidente').empty();
        data.forEach(r => {
  $('#tbodyResidente').append(
    `<tr>
      <td>${r.id}</td>
      <td>${r.nombre}</td>
      <td>${r.apellido}</td>
      <td>${r.genero}</td>
      <td>${r.contacto}</td>
      <td>${r.direccion}</td>
      <td>${r.estado}</td>
      <td>
        <button class="btn btn-sm btn-primary" onclick="editar(${r.id})">Editar</button>
        <button class="btn btn-sm btn-danger" onclick="eliminar(${r.id})">Eliminar</button>
      </td>
    </tr>`
      );
    });});
    }$('#guardar').click(() => {
  const obj = {
    id: $('#id').val(), nombre: $('#nombre').val(), apellido: $('#apellido').val(),
    genero: $('#genero').val(), contacto: $('#contacto').val(),
    direccion: $('#direccion').val(), estado: $('#estado').val()
  };
  $.ajax({
    url: URL,
    type: 'POST',
    contentType: 'application/json',
    data: JSON.stringify(obj),
    success: function(res) {
      alert('Guardado!');
      limpiar();
      cargar();
    },
    error: function(e) {
      alert('Error: ' + e.statusText);
    }
  });
});

    window.editar = id => {
      $.get(URL + id, r => {
        $('#id').val(r.id); $('#nombre').val(r.nombre); $('#apellido').val(r.apellido);
        $('#genero').val(r.genero); $('#contacto').val(r.contacto);
        $('#direccion').val(r.direccion); $('#estado').val(r.estado);
        $('#guardar').hide(); $('#actualizar').show();
      });
    };
    $('#actualizar').click(() => {
      const obj = {
        id: $('#id').val(), nombre: $('#nombre').val(), apellido: $('#apellido').val(),
        genero: $('#genero').val(), contacto: $('#contacto').val(),
        direccion: $('#direccion').val(), estado: $('#estado').val()
      };
      $.ajax({ url: URL + obj.id, type: 'PUT', contentType: 'application/json', data: JSON.stringify(obj),
        success: () => { alert('Actualizado!'); limpiar(); cargar(); },
        error: e => alert('Error: '+e.statusText)
      });
    });
    window.eliminar = id => {
      if(confirm('¿Eliminar residente ID '+id+'?')) {
        $.ajax({ url: URL + id, type: 'DELETE',
          success: () => { cargar(); },
          error: e => alert('Error: '+e.statusText)
        });
      }
    };
    $(document).ready(cargar);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
</body>
</html>
