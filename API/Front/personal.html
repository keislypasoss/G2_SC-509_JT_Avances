<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Gestión de Personal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>


<body>
  <!-- Dentro del body -->
<div id="menu-container"></div>

<script>
  fetch('menu.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('menu-container').innerHTML = html;
    });
</script>
  <div class="container my-5">
    <h1 class="mb-4">Gestión de Personal</h1>

    <form id="formPersonal">
      <div class="row g-3">
        <div class="col-md-2"><label>ID</label><input type="number" id="id" class="form-control" /></div>
        <div class="col-md-3"><label>Nombre</label><input type="text" id="nombre" class="form-control" /></div>
        <div class="col-md-3"><label>Apellido</label><input type="text" id="apellido" class="form-control" /></div>
        <div class="col-md-2"><label>Género</label><select id="genero" class="form-select"><option value="">Seleccione</option><option>Femenino</option><option>Masculino</option><option>Otro</option></select></div>
        <div class="col-md-2"><label>Puesto</label><input type="text" id="puesto" class="form-control" /></div>
        <div class="col-md-3"><label>Fecha Nac.</label><input type="date" id="fecha_nacimiento" class="form-control" /></div>
        <div class="col-md-3"><label>Fecha Contrat.</label><input type="date" id="fecha_contratacion" class="form-control" /></div>
        <div class="col-md-3"><label>Contacto</label><input type="number" id="contacto" class="form-control" /></div>
        <div class="col-md-3"><label>Dirección</label><input type="text" id="direccion" class="form-control" /></div>
        <div class="col-md-2"><label>Estado</label><select id="estado" class="form-select"><option value="">Seleccione</option><option>Activo</option><option>Inactivo</option></select></div>
        <div class="col-md-3"><label>Horario</label><input type="text" id="horario" class="form-control" placeholder="Ej. 7‑15 hrs" /></div>
        <div class="col-md-2"><label>Salario</label><input type="number" id="salario" class="form-control" /></div>
      </div>
      <div class="mt-4 text-center">
        <button type="button" id="guardar" class="btn btn-primary">Guardar</button>
        <button type="button" id="actualizar" class="btn btn-success" style="display:none;">Actualizar</button>
        <button type="button" onclick="limpiar()" class="btn btn-danger">Limpiar</button>
      </div>
    </form>

    <div class="table-responsive mt-5">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr><th>ID</th><th>Nombre</th><th>Apellido</th><th>Puesto</th><th>Estado</th><th>Acciones</th></tr>
        </thead>
        <tbody id="tbodyPersonal"></tbody>
      </table>
    </div>
  </div>

  <script>
    const URL = 'http://localhost:3000/api/personal/';
    function limpiar(){
      $('#formPersonal')[0].reset();
      $('#guardar').show(); $('#actualizar').hide();
    }
    function cargar(){
      $.get(URL, data => {
        $('#tbodyPersonal').empty();
        data.forEach(p => {
          $('#tbodyPersonal').append(
            `<tr>
              <td>${p.id}</td><td>${p.nombre}</td><td>${p.apellido}</td><td>${p.puesto}</td><td>${p.estado}</td>
              <td>
                <button class="btn btn-sm btn-primary" onclick="editar(${p.id})">Editar</button>
                <button class="btn btn-sm btn-danger" onclick="eliminar(${p.id})">Eliminar</button>
              </td>
            </tr>`
          );
        });
      });
    }
    $('#guardar').click(() => {
  const obj = {
    id: $('#id').val(), nombre: $('#nombre').val(), apellido: $('#apellido').val(),
    genero: $('#genero').val(), puesto: $('#puesto').val(),
    fecha_nacimiento: $('#fecha_nacimiento').val(), fecha_contratacion: $('#fecha_contratacion').val(),
    contacto: $('#contacto').val(), direccion: $('#direccion').val(),
    estado: $('#estado').val(), horario: $('#horario').val(), salario: $('#salario').val()
  };

  $.ajax({
    url: URL,
    type: 'POST',
    contentType: 'application/json',
    data: JSON.stringify(obj),
    success: function (res) {
      alert('Guardado!');
      limpiar();
      cargar();
    },
    error: function (e) {
      alert('Error: ' + e.statusText);
    }
  });
});

    window.editar = id => {
      $.get(URL + id, p => {
        $('#id').val(p.id); $('#nombre').val(p.nombre); $('#apellido').val(p.apellido);
        $('#genero').val(p.genero); $('#puesto').val(p.puesto);
        $('#fecha_nacimiento').val(p.fecha_nacimiento.split('T')[0]);
        $('#fecha_contratacion').val(p.fecha_contratacion.split('T')[0]);
        $('#contacto').val(p.contacto); $('#direccion').val(p.direccion);
        $('#estado').val(p.estado); $('#horario').val(p.horario); $('#salario').val(p.salario);
        $('#guardar').hide(); $('#actualizar').show();
      });
    };
    $('#actualizar').click(() => {
      const obj = { /* mismos campos */ id: $('#id').val(), nombre: $('#nombre').val(),
        apellido: $('#apellido').val(), genero: $('#genero').val(), puesto: $('#puesto').val(),
        fecha_nacimiento: $('#fecha_nacimiento').val(), fecha_contratacion: $('#fecha_contratacion').val(),
        contacto: $('#contacto').val(), direccion: $('#direccion').val(),
        estado: $('#estado').val(), horario: $('#horario').val(), salario: $('#salario').val()
      };
      $.ajax({ url: URL + obj.id, type: 'PUT', contentType: 'application/json', data: JSON.stringify(obj),
        success: () => { alert('Actualizado!'); limpiar(); cargar(); },
        error: e => alert('Error: '+e.statusText)
      });
    });
    window.eliminar = id => {
      if(confirm('¿Eliminar personal con ID '+id+'?')) {
        $.ajax({ url: URL + id, type: 'DELETE',
          success: () => { cargar(); },
          error: e => alert('Error: '+e.statusText)
        });
      }
    };
    $(document).ready(cargar);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
</body>
</html>
